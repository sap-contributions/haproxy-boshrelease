#!/usr/bin/env bash

set -euo pipefail

JOB_NAME=haproxy
JOB_DIR=/var/vcap/jobs/${JOB_NAME}
RUN_DIR=/var/vcap/sys/run/${JOB_NAME}
LOG_DIR=/var/vcap/sys/log/${JOB_NAME}

case $1 in

start)
	exec "${JOB_DIR}/bin/haproxy_wrapper" \
		>> "${LOG_DIR}/${JOB_NAME}.stdout.log" \
		2>> "${LOG_DIR}/${JOB_NAME}.stderr.log"
	;;

stop)
	kill -TERM "$(cat ${RUN_DIR}/haproxy.pid)"
	;;

*)
	echo "Usage: ctl {start|stop}"
	;;

esac
